<Window
    x:Class="Shipwreck.HlsDownloader.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:Shipwreck.HlsDownloader"
    mc:Ignorable="d"
    Title="MainWindow"
    Height="450"
    Width="800"
    Loaded="Window_Loaded">
    <Window.DataContext>
        <local:MainWindowViewModel />
    </Window.DataContext>
    <TabControl>
        <TabItem
            Header="リクエスト">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition
                        Height="8" />
                    <RowDefinition
                        Height="200" />
                    <RowDefinition
                        Height="Auto" />
                </Grid.RowDefinitions>
                <DockPanel
                    Name="webViewParent">
                    <DockPanel
                        DockPanel.Dock="Top">
                        <Button
                            DockPanel.Dock="Right"
                            Click="Button_Click">Go</Button>
                        <TextBox
                            Text="{Binding Url}" />
                    </DockPanel>
                </DockPanel>
                <GridSplitter
                    Grid.Row="1"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch" />

                <DockPanel
                    Grid.Row="2">
                    <WrapPanel
                        DockPanel.Dock="Top"
                        Orientation="Horizontal">
                        <Label>形式</Label>
                        <ComboBox
                            IsEditable="True"
                            MinWidth="120"
                            Text="{Binding ContentTypeFilter, UpdateSourceTrigger=PropertyChanged}" />
                    </WrapPanel>
                    <DataGrid
                        AutoGenerateColumns="False"
                        IsReadOnly="True"
                        ItemsSource="{Binding Requests}"
                        SelectedItem="{Binding SelectedRequest}"
                        FrozenColumnCount="2"
                        HeadersVisibility="Column"
                        SelectionMode="Single"
                        SelectionUnit="FullRow">
                        <DataGrid.Columns>
                            <DataGridTextColumn
                                Binding="{Binding Method}" />
                            <DataGridTextColumn
                                Header="URL"
                                Binding="{Binding Url}"
                                Width="400" />
                            <DataGridTextColumn
                                Header="結果"
                                Binding="{Binding StatusCode}" />
                            <DataGridTextColumn
                                Header="サイズ"
                                Binding="{Binding ContentLength, StringFormat='#,0'}" />
                            <DataGridTextColumn
                                Header="形式"
                                Binding="{Binding ContentType}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
                <Button
                    Grid.Row="3"
                    HorizontalAlignment="Right"
                    MinWidth="60"
                    Margin="8 4"
                    Padding="8 4"
                    Command="{Binding SetRequestToDownloaderCommand}">
                    <Button.Style>
                        <Style
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding SelectedRequest}"
                                    Value="{x:Null}">
                                    <Setter
                                        Property="IsEnabled"
                                        Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    選択
                </Button>
            </Grid>
        </TabItem>
        <TabItem
            Header="ダウンロード"
            IsSelected="{Binding IsDownloaderShown}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition
                        Height="Auto" />
                    <RowDefinition
                        Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Label
                        Margin="8 4">m3u8 URL</Label>
                    <TextBox
                        Margin="8 4"
                        Grid.Column="1"
                        Text="{Binding M3u8Url}" />
                </Grid>
                <GroupBox
                    Grid.Row="1"
                    Header="フォルダーに保存">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition
                                Height="Auto" />
                            <RowDefinition
                                Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition
                                Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Label
                            Margin="8 4">保存先</Label>
                        <DockPanel
                            Margin="8 4"
                            Grid.Column="1">
                            <Button
                                DockPanel.Dock="Right">...</Button>
                            <TextBox
                                Text="{Binding DestinationM3u8}" />
                        </DockPanel>
                        <Button
                            Grid.Row="2"
                            Grid.Column="1"
                            HorizontalAlignment="Right"
                            MinWidth="60"
                            Margin="8 4"
                            Padding="8 4"
                            Command="{Binding DownloadCommand}">保存</Button>
                    </Grid>
                </GroupBox>
                <ListBox
                    Name="downloaderLogListBox"
                    Grid.Row="2"
                    ItemsSource="{Binding DownloaderLog}">

                </ListBox>
            </Grid>
        </TabItem>
    </TabControl>
</Window>
